<tool id="dims_anticipated_purity" name="Calculate anticipated precursor ion purity (DIMS)" version="0.1.0">
    <requirements>
        <requirement type="package" >R</requirement>
	    <requirement type="package" >r-optparse</requirement>
        <requirement type="package" >msPurity</requirement>
    </requirements>
    <description>Calculate the anticipated precursor ion purity from a DIMS dataset.
    </description>

    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command interpreter="Rscript"><![CDATA[
        dimsPredictPurity.R
                --mzML_file=$mzML_file
                --mzs=$mzs
                --out_dir=.
                --minOffset=$minoffset
                --maxOffset=$maxoffset
                --ppm=$ppm
                --iwNorm=$iw_norm
                #if $sim
                    --sim
                #end if
    ]]></command>
    <inputs>
        <param type="data" name="mzML_file"
                help="mzML file to calculate metric from (--mzML_file)"/>
        <param type="data" name="mzs"
                help="file with list of mz values to check (--mzs)"/>
        <param name="minoffset" type="float" label="minoffset" value="0.5"
                    help="Offset to the 'left' for the precursor range e.g. if precursor of interest is
                    100.0 then the range would be from 999.5 to 100.0 (--minoffset)"/>
        <param name="maxoffset" type="float" label="maxoffset" value="0.5"
                    help="Offset to the 'right' for the precursor range  e.g. if precursor of interest is
                    100.0 then the range would be from 100.0 to 100.5 (--maxoffset)"/>
        <param name="ppm" type="float" label="ppm tolerance" value="4"
                    help="ppm tolerance for the precursor to be found within the mzML file (--ppm)"/>
        <param name="sim" type="boolean" label="SIM-Stitch experiment?" help=""/>
        <param name="iw_norm" type="select" label="Normalisation for isolation efficiency">
                <option value="gauss" >Gaussian</option>
                <option value="rcosine" >Raised cosine</option>
                <option value="QE5"> Calculated from Q-Exactive for +/- 0.5 Da windows </option>
                <option value="none" selected="true" >No normalisation</option>
        </param>

    </inputs>
    <outputs>
	    <data name="anticipated_dims_purity.txt" format="tabular" label="anticipated_dims_purity.txt"
              from_work_dir="anticipated_dims_purity.txt" visible="true"/>
    </outputs>
    <tests>
        <test>
            <param name="mzML_file" value="SIMstitch_data.mzML" type="data"  />
            <param name="sim" value="TRUE" />
            <param name="mzs" type="tabular"  value="mzs.txt" />
            <output name="anticipated_dims_purity.txt" type="tabular" file="anticipated_dims_purity.txt">
                <assert_contents>
                    <has_n_columns n="7" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[

=============================================================
Calculate anticipated precursor ion purity from DI-MS dataset
=============================================================
-----------
Description
-----------

Tool to calculate the anticipated precursor ion purity of selected precursor based on a prior DI-MS dataset. The dataset
 can either be in the form of multiple 'full scans' or a SIM-Stitch dataset. See the Bioconductor documentation for more
 details, function msPurity::dimsPredictPurity()

--------------
Output example
--------------
Output consists of the mz column (along with any other columns that were in the original mz file). The median and
mean calculated purity. The standard deviation (sdPurity), coefficient of variation (relative standard deviation)
cvPurity, the standard error of the purity (sdePurity) and the median number of peaks within the isolation window
(medianPeakNum)

============= ============= ============= ================ ================ ================ ================
mz            medianPurity  meanPurity    sdPurity         cvPurity	        sdePurity        medianPeakNum
============= ============= ============= ================ ================ ================ ================
50.20428      0.39          0.39          0.0007           0.19             0.0005           3
------------- ------------- ------------- ---------------- ---------------- ---------------- ----------------
56.91206      0.01          0.01          0.0002           4.53             0.0001           12
------------- ------------- ------------- ---------------- ---------------- ---------------- ----------------
62.02906      0.14          0.13          0.0014           22.63            0.0009           7
------------- ------------- ------------- ---------------- ---------------- ---------------- ----------------
75.07431      0.93          0.94          0.019            37.87            0.0134           3
============= ============= ============= ================ ================ ================ ================

    ]]></help>
</tool>