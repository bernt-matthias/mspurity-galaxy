<tool id="frag4feature" name="frag4feature" version="0.0.7">
    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements">
        <!-- would ideally have xcms 3.0.0 but not available in bioconda at the point of tool creation-->
        <requirement type="package" version="1.46.0" >bioconductor-xcms</requirement>
    </expand>

    <description>
        Assign fragmentation spectra to XCMS features using msPurity
    </description>
 <stdio>
        <exit_code range="1:" />
    </stdio>
    <command interpreter="Rscript"><![CDATA[
        frag4feature.R
            --out_dir=.
            --xset=$xset
            --pa=$pa
            --cores=\${GALAXY_SLOTS:-4}
            #if $file_load_conditional.file_load_select
                --mzML_files='
                #for $i in $file_load_conditional.input
                    $i,
                #end for
                '
                --galaxy_names='
                #for $i in $file_load_conditional.input
                    $i.name,
                #end for
                '
            #end if
            @frag4feature@

    ]]></command>
    <inputs>

        <param type="data" name="xset" label="xcmsSet object"
               help="xcmsSet object saved as 'xset' in an RData file"/>
        <param type="data" name="pa" label="purityA object"
               help="purityA object saved as 'pa' in a RData file (output from assess_purity_msms)"/>

    <expand macro="frag4feature" />
    <expand macro="fileload" />

    </inputs>
    <outputs>
	    <data name="frag4feature_grouped_msms" format="tsv" label="${tool.name} on ${on_string}: tsv"
              from_work_dir="frag4feature.tsv" visible="true"/>
        <data name="frag4feature_rdata" format="rdata" label="${tool.name} on ${on_string}: RData"
              from_work_dir="frag4feature.RData" visible="true"/>
        <data name="frag4feature_sqlite" format="sqlite" label="${tool.name} on ${on_string}: Sqlite"
              from_work_dir="alldata.sqlite" visible="true"/>
    </outputs>
    <tests>
        <test>
            <conditional name="file_load_conditional">
                <param name="file_load_select" value="yes"/>
                <param name="input" >
                    <collection type="list">
                        <element name="LCMS_1.mzML" value="LCMS_1.mzML"/>
                        <element name="LCMS_2.mzML" value="LCMS_2.mzML"/>
                        <element name="LCMSMS_1.mzML" value="LCMSMS_1.mzML"/>
                        <element name="LCMSMS_2.mzML" value="LCMSMS_2.mzML"/>
                    </collection>
                </param>
            </conditional>
            <param name="xset" value="LCMS_1_LCMS_2_LCMSMS_1_LCMSMS_2.xset.group.rdata"/>
            <param name="pa" value="LCMS_1_LCMS_2_LCMSMS_1_LCMSMS_2.assess_purity.rdata"/>
            <output name="frag4feature.tsv" value="frag4feature.tsv" >
            </output>
        </test>
    </tests>
    <help><![CDATA[

    ]]></help>
</tool>
