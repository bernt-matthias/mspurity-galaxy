<tool id="frag4feature" name="frag4feature" version="0.0.1">
    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements" />

    <description>
        Assign fragmentation spectra to XCMS features using msPurity
    </description>
 <stdio>
        <exit_code range="1:" />
    </stdio>
    <command interpreter="Rscript"><![CDATA[
        frag4feature.R
            --out_dir=.
            --xset=$xset
            --pa=$pa
            --ppm=$ppm
            --plim=$plim
            #if $mostIntense
                --mostIntense
            #end if
            #if $convert2RawRT
                --convert2RawRT
            #end if

    ]]></command>
    <inputs>

        <param type="data" name="xset" label="xcmsSet object"
               help="xcmsSet object saved as 'xset' in an RData file"/>
        <param type="data" name="pa" label="purityA object"
               help="purityA object saved as 'pa' in a RData file (output from assess_purity_msms)"/>

        <param name="mostIntense" type="boolean" checked="true" label="Use most intense peak within isolation window for precursor?"
               help="If yes, this will ignore the recorded precursor within the mzML file and use
               use the most intense peak within the isolation window for mapping"/>

        <param name="convert2RawRT" type="boolean" checked="false" label="Was retention time correction used?"
               help="If retention time correction has been used in XCMS set this to yes"/>

        <param name="ppm" type="float" label="ppm" value="10"
                    help="ppm tolerance between precursor mz and feature mz"/>

        <param name="plim" type="float" label="plim" value="0" max="1" min="0"
                    help="min purity of precursor to be included"/>


    </inputs>
    <outputs>
	    <data name="frag4feature_grouped_msms" format="tsv" label="${tool.name} on ${on_string}: tsv"
              from_work_dir="frag4feature.tsv" visible="true"/>
        <data name="frag4feature_rdata" format="rdata" label="${tool.name} on ${on_string}: RData"
              from_work_dir="frag4feature.RData" visible="true"/>
    </outputs>
    <tests>
        <!--<test>-->
            <!--<conditional name="file_load_conditional">-->
                <!--<param name="file_load_select" value="yes"/>-->
                <!--<param name="input" >-->
                    <!--<collection type="list">-->
                        <!--<element name="LCMS_1.mzML" value="LCMS_1.mzML"/>-->
                        <!--<element name="LCMS_2.mzML" value="LCMS_2.mzML"/>-->
                    <!--</collection>-->
                <!--</param>-->
            <!--</conditional>-->
            <!--<conditional name="xgroups">-->
                <!--<param name="xgroups" value="choose"/>-->
                <!--<param name="xgroups_value" value="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15"/>-->
            <!--</conditional>-->
            <!--<param name="iw_norm" value="QE5" />-->
            <!--<param name="xset" value="xset.RData"/>-->

            <!--<output name="anticipated_purity_lcms.tsv" value="anticipated_purity_lcms.tsv" >-->
            <!--</output>-->
        <!--</test>-->
    </tests>
    <help><![CDATA[

    ]]></help>
</tool>